const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-1SqZ7gU4.js","assets/index-D2g_LI3L.css"])))=>i.map(i=>d[i]);
import{r,j as e,c as S,S as k,g as C,B as O,h as E,i as T,k as V,l as F,R as P,E as g,D as R,b as B,d as L,e as $,f as A,O as H,_ as I}from"./index-1SqZ7gU4.js";import{B as f}from"./book-Tj5IJwAX.js";function o(n){return n.blob_metadata_id||n.blob_id}function q({sources:n,className:j,messageId:i}){const[b,v]=r.useState(!1),[N,d]=r.useState(!1),[a,c]=r.useState(null),[w,m]=r.useState(!1),x=async t=>{var p;const l=o(t);if(!l)return;m(!0),d(!0);const h=t.title||"Document";try{const{fileApi:s}=await I(async()=>{const{fileApi:D}=await import("./index-1SqZ7gU4.js").then(_=>_.aN);return{fileApi:D}},__vite__mapDeps([0,1])),u=await s.getDocumentMetadata(l),y=((p=u.metadata)==null?void 0:p.content)||"Document content is being processed. Please try again later.";c({title:u.filename||h,content:y})}catch(s){console.error("Error loading document:",s),c({title:h,content:"Error loading document. Please try again."})}finally{m(!1)}console.log("Full document requested:",{messageId:i,sourceTitle:t.title,documentId:l,blob_metadata_id:t.blob_metadata_id,blob_id:t.blob_id,variant:"right-panel",timestamp:new Date().toISOString()})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:S("not-prose mb-4",j),children:e.jsxs(k,{open:b,onOpenChange:v,children:[e.jsx(C,{asChild:!0,children:e.jsxs(O,{variant:"ghost",size:"sm",className:"text-primary text-xs font-medium flex items-center gap-2","data-message-id":i,"aria-label":`View ${n.length} source${n.length!==1?"s":""}`,children:[e.jsx(f,{className:"h-4 w-4","aria-hidden":"true"}),e.jsxs("span",{children:["Used ",n.length," source",n.length!==1?"s":""]})]})}),e.jsxs(E,{side:"right",className:"w-full sm:max-w-md",children:[e.jsxs(T,{children:[e.jsx(V,{children:"Sources"}),e.jsxs(F,{children:[n.length," reference",n.length!==1?"s":""," used in this response"]})]}),e.jsx("div",{className:"mt-6 space-y-4 overflow-y-auto pr-2",style:{maxHeight:"calc(100vh - 180px)"},role:"list","aria-label":"Citation sources",children:n.map((t,l)=>e.jsx("div",{className:"space-y-3",role:"listitem",children:t.content?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none px-4",children:e.jsx(P,{children:t.content})}),e.jsx("div",{className:"pt-3 border-t border-border px-4",children:t.url?e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline inline-flex items-center gap-1",onClick:()=>{console.log("Citation clicked:",{messageId:i,sourceUrl:t.url,sourceTitle:t.title,variant:"right-panel",timestamp:new Date().toISOString()})},children:["View source: ",t.title,e.jsx(g,{className:"h-3 w-3 flex-shrink-0","aria-hidden":"true"})]}):o(t)?e.jsxs("button",{type:"button",onClick:()=>x(t),className:"text-xs text-primary hover:underline inline-flex items-center gap-1",children:["View full document: ",t.title," →"]}):null})]}):e.jsx("div",{className:"group rounded-lg border border-border p-4 transition-colors hover:bg-accent",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(f,{className:"h-4 w-4 mt-0.5 flex-shrink-0 text-muted-foreground group-hover:text-primary transition-colors","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"font-medium text-foreground",children:t.title}),t.snippet&&e.jsx("blockquote",{className:"text-sm text-muted-foreground italic border-l-2 border-muted pl-3 py-1",children:t.snippet}),t.url&&e.jsx("div",{className:"text-muted-foreground text-xs break-all",children:t.url}),e.jsx("div",{className:"pt-2",children:t.url?e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline inline-flex items-center gap-1",onClick:()=>{console.log("Citation clicked:",{messageId:i,sourceUrl:t.url,sourceTitle:t.title,variant:"right-panel",timestamp:new Date().toISOString()})},children:["View source",e.jsx(g,{className:"h-3 w-3","aria-hidden":"true"})]}):o(t)?e.jsx("button",{type:"button",onClick:()=>x(t),className:"text-xs text-primary hover:underline inline-flex items-center gap-1 text-left",children:"View full document →"}):null})]})]})})},`${i}-${l}`))})]})]})}),e.jsx(R,{open:N,onOpenChange:d,children:e.jsxs(B,{className:"sm:max-w-5xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(L,{children:[e.jsx($,{children:(a==null?void 0:a.title)||"Document"}),e.jsx(A,{children:"Full document content"})]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:w?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})}):a!=null&&a.content?e.jsx(H,{children:a.content}):e.jsx("p",{className:"text-muted-foreground",children:"No content available"})})]})})]})}export{q as RightPanelCitations};
