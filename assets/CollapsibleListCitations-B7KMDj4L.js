const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C5XWF4fC.js","assets/index-D2g_LI3L.css"])))=>i.map(i=>d[i]);
import{j as e,$ as T,c as j,a0 as $,a1 as F,a2 as L,a3 as q,r as u,D as M,b as P,d as R,e as A,f as Q,O as z,a4 as B,R as K,a5 as w,_ as V}from"./index-C5XWF4fC.js";import{B as H}from"./book-DRnJYcBu.js";const U=({className:t,...a})=>e.jsx(T,{className:j("not-prose mb-2 text-primary text-xs",t),...a}),G=({className:t,count:a,children:n,...i})=>e.jsx($,{className:j("flex items-center gap-2",t),...i,children:n??e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-medium",children:["Used ",a," ",a===1?"source":"sources"]}),e.jsx(F,{className:"h-4 w-4"})]})}),I=({className:t,...a})=>e.jsx(L,{className:j("mt-3 flex w-fit flex-col gap-2","data-[state=closed]:fade-out-0 data-[state=closed]:slide-out-to-top-2 data-[state=open]:slide-in-from-top-2 outline-none data-[state=closed]:animate-out data-[state=open]:animate-in",t),...a}),J=({href:t,title:a,children:n,...i})=>e.jsx("a",{className:"flex items-center gap-2",href:t,rel:"noreferrer",target:"_blank",...i,children:n??e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"block font-medium",children:a})]})});function S(t){return t.blob_metadata_id||t.blob_id}function v({source:t,index:a,messageId:n,onSourceClick:i,onValidityChange:d}){const p=S(t),{data:s,isError:m,isLoading:f}=B(p&&!t.title?p:void 0);if(u.useEffect(()=>{d&&(m?d(a,!1):!f&&(s||t.title)&&d(a,!0))},[m,f,s,t.title,a,d]),m)return console.warn("Citation source not found:",{blob_metadata_id:t.blob_metadata_id,blob_id:t.blob_id,messageId:n,index:a}),null;const b=(s==null?void 0:s.filename)||t.title||(f?"Loading...":void 0);return b?e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{href:t.url||"#",title:b,onClick:x=>i(t,x)}),t.content&&e.jsx("div",{className:"pl-6 prose prose-sm dark:prose-invert max-w-none",children:e.jsx(K,{children:t.content})})]},`${n}-${a}`):(console.warn("Citation source has no title:",{blob_metadata_id:t.blob_metadata_id,blob_id:t.blob_id,messageId:n,index:a}),null)}function Y({sources:t,className:a,messageId:n}){const i=q(),[d,p]=u.useState(!1),[s,m]=u.useState(null),[f,b]=u.useState(!1),[x,C]=u.useState(new Set),_=u.useCallback((l,o)=>{C(r=>{const c=new Set(r);return o?c.add(l):c.delete(l),c})},[]),g=async(l,o)=>{var D;o.preventDefault();const r=S(l);if(l.url&&!r){window.open(l.url,"_blank","noopener,noreferrer");return}if(!r)return;b(!0),p(!0);const c=i.getQueryData(w.detail(r)),y=(c==null?void 0:c.filename)||l.title||"Document";try{const h=await i.ensureQueryData({queryKey:w.detail(r),queryFn:async()=>{const{fileApi:k}=await V(async()=>{const{fileApi:E}=await import("./index-C5XWF4fC.js").then(O=>O.aN);return{fileApi:E}},__vite__mapDeps([0,1]));return await k.getDocumentMetadata(r)}}),N=((D=h.metadata)==null?void 0:D.content)||"Document content is being processed. Please try again later.";m({title:h.filename,content:N})}catch(h){console.error("Error loading document:",h),m({title:y,content:"Error loading document. Please try again."})}finally{b(!1)}console.log("Full document requested:",{messageId:n,sourceTitle:y,documentId:r,blob_metadata_id:l.blob_metadata_id,blob_id:l.blob_id,timestamp:new Date().toISOString()})};return x.size===0&&t.length>0?e.jsx("div",{style:{display:"none"},children:t.map((l,o)=>e.jsx(v,{source:l,index:o,messageId:n,onSourceClick:g,onValidityChange:_},`${n}-${o}`))}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{className:a,"data-message-id":n,children:[e.jsx(G,{count:x.size}),e.jsx(I,{children:t.map((l,o)=>e.jsx(v,{source:l,index:o,messageId:n,onSourceClick:g,onValidityChange:_},`${n}-${o}`))})]}),e.jsx(M,{open:d,onOpenChange:p,children:e.jsxs(P,{className:"sm:max-w-5xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(A,{children:(s==null?void 0:s.title)||"Document"}),e.jsx(Q,{children:"Full document content"})]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:f?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})}):s!=null&&s.content?e.jsx(z,{children:s.content}):e.jsx("p",{className:"text-muted-foreground",children:"No content available"})})]})})]})}export{Y as CollapsibleListCitations};
